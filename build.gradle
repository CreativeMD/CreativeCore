plugins {
    id 'java-library'
    id 'eclipse'
    id 'maven-publish'
    id 'net.minecraftforge.gradle' version '[6.0,6.2)'
    id 'org.spongepowered.mixin' // version '0.7.+' // use it for standalone running
}

base {
    archivesName = "${modname}_FORGE_v${fgversion}_mc${mcversion}"
}

java.toolchain.languageVersion = JavaLanguageVersion.of(17)
minecraft {
    accessTransformer = file("src/main/resources/META-INF/accesstransformer.cfg")
    copyIdeResources = true
    mappings channel: 'official', version: mcversion
}

dependencies {
    minecraft "net.minecraftforge:forge:${mcversion}-${fgversion}"
}

jar {
    manifest {
        attributes([
                "Specification-Title": modname,
                "Specification-Vendor": modauthor,
                "Specification-Version": modversion,
                "Implementation-Title": modname,
                "Implementation-Version"  : modversion,
                "Implementation-Vendor": modauthor,
                "Implementation-Timestamp": new Date().format("yyyy-MM-dd'T'HH:mm:ssZ"),
                "MixinConfigs": "${modid}.mixin.json"
        ])
    }
    duplicatesStrategy = DuplicatesStrategy.INCLUDE
}

processResources {
    filesMatching(['META-INF/mods.toml', 'pack.mcmeta']) {
        expand project.properties
    }
}

mixin {
    add sourceSets.main, "${modid}.mixins.refmap.json"
    config "${modid}.mixins.json"
}

jar.finalizedBy('reobfJar')
tasks.withType(JavaCompile).configureEach {
    options.encoding = 'UTF-8' // Use the UTF-8 charset for Java compilation
}
tasks.processResources.outputs.upToDateWhen { false }